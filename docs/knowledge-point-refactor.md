# 知识点与题库管理逻辑重构需求文档

## 需求背景

当前知识点与题目、题库的关系需要重构，将知识点从"题目属性"转变为"题库属性"，使知识管理更加结构化。

---

## 核心变更

### 1. 知识点归属变更

**现状**：知识点从题目生成，题目可以自由创建知识点
**目标**：知识点由题库统一管理，题目只能引用题库中已有的知识点

**数据关系**：

- 题库（Topic）：定义和管理知识点列表（知识点的"源头"）
- 题目（Question）：仍然拥有知识点属性，但**只能从所属题库的知识点中选择**（约束引用）

**规则**：

- 一个题库可以有多个不重复的知识点
- 题目生成/编辑时，知识点必须从所属题库的已有知识点中选择
- 不允许题目自由创建新知识点

### 2. 新增题目时的题库选择逻辑

**取消**：新增题目时的"新增题库"选项

**新增**：智能匹配 + 建议机制

- 如果题目不适合放在任何已有题库中：
  - 自动选择一个最相近的题库
  - 显示提示："此题目不适合存放在任何已有题库中，建议新增题库：【AI 生成的建议题库名】"

### 3. 题库大纲功能（新增）

**大纲 = 题库的描述**

大纲生成方式：

- 用户手动添加大纲
- AI 根据题库名称自动生成大纲

大纲用途：

- 作为题库的描述信息
- 作为生成知识点的依据

### 4. 知识点管理功能

**触发条件**：题库有大纲后

操作方式：

- 点击"生成知识点"：AI 根据大纲自动生成
- 手动添加知识点
- 手动删除知识点

### 5. 题库管理功能增强

用户随时可以：

- 删除题库
- 重命名题库
- 修改大纲

---

## 数据模型变更（预估）

```
Topic (题库)
├── id
├── name (名称)
├── outline (大纲/描述) -- 新增字段
├── knowledgePoints[] (知识点列表) -- 新增：题库级知识点定义
└── questions[] (题目列表)

Question (题目)
├── id
├── topicId (所属题库)
├── knowledgePoints[] (知识点) -- 保留，但必须引用所属 Topic 的知识点
└── ...其他字段
```

**约束**：`Question.knowledgePoints ⊆ Topic.knowledgePoints`（题目知识点必须是题库知识点的子集）

---

## 用户交互流程

### 流程 A：题库知识点管理

```
题库详情页
    │
    ├── 无大纲 ──> [手动添加大纲] 或 [AI 生成大纲]
    │
    └── 有大纲 ──> [生成知识点] / [手动添加] / [删除知识点]
```

### 流程 B：新增题目时的题库匹配

```
输入题目内容
    │
    ├── 匹配到合适题库 ──> 直接选择
    │
    └── 无合适题库 ──> 选择最相近的 + 显示建议提示
                       "建议新增题库：【AI 建议名称】"
```

---

## 涉及文件（预估）

- 数据库 Schema：`lib/db/schema.ts`
- AI 题目分析：`lib/ai/question-analyzer.ts`
- 题库管理 UI：需新增/修改组件
- Agent 动作：`app/actions/agent.ts`

---

## 优先级建议

1. **P0**：数据模型变更（Topic 新增 outline 字段，knowledgePoints 迁移）
2. **P0**：题库大纲管理 UI
3. **P1**：知识点生成/管理功能
4. **P1**：新增题目时的智能匹配 + 建议机制
5. **P2**：题库删除/重命名/大纲修改功能
