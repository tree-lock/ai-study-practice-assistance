---
description: "[已弃用] 项目已迁移至 Tailwind + shadcn/ui，不再使用 Radix Themes。图标按钮请使用 @/components/ui/button 的 variant=ghost size=icon。"
globs: "**/*.tsx"
alwaysApply: false
---

# [已弃用] Radix Ghost Button UI 重叠问题修复指南

**本项目已弃用 Radix Themes，改用 Tailwind CSS + shadcn/ui。** 以下内容仅作历史参考。

## 问题识别

当发现以下 UI 问题时，很可能是 Radix `IconButton` 或 `Button` with `variant="ghost"` 导致的：

### 典型症状

1. **元素重叠**：按钮与相邻元素发生重叠
2. **布局错位**：按钮位置偏离预期位置
3. **间距异常**：按钮周围出现负边距效应
4. **悬停/点击区域偏移**：交互区域与视觉位置不匹配

### 诊断步骤

1. **检查浏览器 DevTools**：
   - 检查按钮元素是否应用了负 `margin`
   - 查看计算后的样式中是否有 `margin-left` 或 `margin-top` 为负值
   - Radix Ghost Button 通常应用 `margin: -4px` 或类似的负值

2. **确认按钮类型**：
   - 检查是否使用了 `<IconButton variant="ghost">`
   - 检查是否使用了 `<Button variant="ghost">`

3. **布局上下文**：
   - 问题常出现在 flex 容器、grid 布局或定位元素附近
   - 独立站按钮或紧凑布局中更容易出现

## 解决方案

### 方案 1：使用容器包装（首选）

对于独立的图标按钮，使用容器包装来隔离负边距：

```tsx
// ❌ 错误：直接使用 Ghost Button 导致重叠
<IconButton variant="ghost" aria-label="操作">
  <MoreHorizontal />
</IconButton>

// ✅ 正确：使用容器包装，添加 p-px 抵消负边距
<div className="p-px">
  <IconButton variant="ghost" aria-label="操作">
    <MoreHorizontal />
  </IconButton>
</div>
```

### 方案 2：使用 style 覆盖负边距

当容器包装不可行时，直接使用 style 覆盖：

```tsx
// ✅ 使用 style 明确覆盖负边距
<IconButton 
  variant="ghost" 
  aria-label="操作"
  style={{ margin: 0 }}
>
  <MoreHorizontal />
</IconButton>
```

### 方案 3：自定义 Button 组件（彻底解决）

如果某个位置的 Ghost Button 反复出现问题，创建自定义 Button 组件：

```tsx
// components/ghost-icon-button.tsx
'use client';

import { IconButton, type IconButtonProps } from '@radix-ui/themes';
import { forwardRef } from 'react';

/**
 * 修复了 Radix IconButton 的负边距问题的 Ghost Button 组件
 * 适用于容易出现的 UI 重叠的场景
 */
export const GhostIconButton = forwardRef<HTMLButtonElement, IconButtonProps>(
  function GhostIconButton(props, ref) {
    return (
      <IconButton
        ref={ref}
        variant="ghost"
        {...props}
        style={{
          ...props.style,
          margin: 0, // 覆盖 Radix 默认的负边距
        }}
      />
    );
  }
);
```

使用方式：

```tsx
import { GhostIconButton } from '@/components/ghost-icon-button';

// ✅ 使用自定义组件，不会出现重叠问题
<GhostIconButton aria-label="操作">
  <MoreHorizontal />
</GhostIconButton>
```

## 决策流程

```
发现 UI 重叠问题
    ↓
检查 DevTools 确认是否有负 margin
    ↓
是 Radix Ghost Button 导致？
    ├─ 否 → 查找其他原因
    └─ 是 → 选择解决方案
         ├─ 独立按钮 → 方案 1：容器包装 (p-px)
         ├─ 特殊布局 → 方案 2：style 覆盖
         └─ 重复出现问题 → 方案 3：自定义组件
```

## 注意事项

1. **Flex 容器中的全宽按钮**：
   - 如果 Ghost Button 在 flex 容器中且占满宽度（如 sidebar actions），通常不需要修复
   - 负边距会被容器边界裁剪，不影响布局

2. **容器包装的 padding 值**：
   - 使用 `p-px` (1px) 通常足够抵消 Radix 的负边距
   - 如果问题仍然存在，尝试 `p-0.5` (2px)

3. **样式优先级**：
   - 使用 `style` 属性可以确保覆盖 Radix 的默认样式
   - 避免使用 `!important`，优先使用内联 style

4. **验证修复**：
   - 修复后检查按钮的交互区域是否正常
   - 确认悬停和点击效果没有偏移
   - 测试响应式布局下的表现

## 常见错误模式

```tsx
// ❌ 错误：试图用 className 覆盖，但优先级不够
<IconButton variant="ghost" className="m-0">
  {/* 仍然有重叠 */}
</IconButton>

// ❌ 错误：使用负 margin 来"修复"，实际上更糟
<IconButton variant="ghost" className="-ml-1">
  {/* 加重问题 */}
</IconButton>

// ✅ 正确：使用 style 或容器包装
<div className="p-px">
  <IconButton variant="ghost">
    {/* 正常工作 */}
  </IconButton>
</div>
```

## 测试清单

修复完成后，验证以下项目：

- [ ] 按钮与相邻元素无重叠
- [ ] 悬停状态视觉反馈正常
- [ ] 点击区域与视觉位置匹配
- [ ] 响应式布局下表现正常
- [ ] 无障碍功能（键盘导航）正常
